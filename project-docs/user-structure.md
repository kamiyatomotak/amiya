# Chrona Bot ユーザーフローとプロジェクト構造

## 1. ユーザーフロー / データフロー (自動実行)

このボットはユーザーが直接操作するものではなく、GitHub Actions によって自動実行されます。以下は、その自動実行時の処理フローです。

```mermaid
graph TD
    A[GitHub Actions スケジュール起動 (毎日 23:00 UTC)] --> B(ワークフロー実行開始);
    B --> C{Docker コンテナ起動};
    C --> D[リポジトリからコードをチェックアウト];
    D --> E[Python スクリプト実行];
    E --> F(現在日時取得);
    F --> G{年の進行状況計算};
    G --> H[経過日数, 総日数, 進行率算出];
    H --> I{テキストメーター生成};
    I --> J[メーター文字列作成];
    H --> K{Gemini API 呼び出し};
    K -- 成功 --> L[示唆に富む一文取得];
    K -- 失敗 --> M[代替文言使用 & エラーログ];
    L --> N{ツイート本文組み立て};
    M --> N;
    J --> N;
    H --> N;
    N --> O{X API 呼び出し (ツイート投稿)};
    O -- 成功 --> P[投稿成功ログ];
    O -- 失敗 --> Q[エラーログ];
    P --> R(スクリプト終了);
    Q --> R;
    R --> S{Docker コンテナ停止・破棄};
    S --> T(ワークフロー実行完了);
```

**主要なデータの流れ:**

1.  **日時情報:** スクリプト実行時に取得され、進行状況計算に使われる。
2.  **計算結果:** 経過日数、総日数、進行率が計算され、テキストメーター生成とツイート本文組み立てに使われる。
3.  **テキストメーター:** 進行率から生成され、ツイート本文に使われる。
4.  **Gemini 生成文:** Gemini API から取得 (または代替文言) され、ツイート本文に使われる。
5.  **ツイート本文:** 上記のデータから組み立てられ、X API に渡される。
6.  **ログ情報:** 各処理ステップやエラー発生時に生成され、GitHub Actions のログに出力される。

## 2. プロジェクトファイル構造 (推奨)

```
chrona-bot/
├── .github/
│   └── workflows/
│       └── cron_tweet.yml      # GitHub Actions ワークフロー定義ファイル
├── .gitignore                  # Git で追跡しないファイルを指定
├── Dockerfile                  # Docker イメージ構築用ファイル
├── requirements.txt            # Python ライブラリの依存関係リスト
├── main.py                     # メインの Python スクリプト (全ての処理を実装)
├── .env.example                # ローカル開発用環境変数ファイルの例 (キー名のみ記載)
├── .env                        # ローカル開発用環境変数ファイル (Git管理外)
├── .venv/                      # Python 仮想環境フォルダ (Git管理外)
├── project-docs/               # ★このプロジェクトドキュメント群
│   ├── overview.md             # プロジェクト概要
│   ├── requirements.md         # 要件と機能
│   ├── tech-specs.md           # 技術仕様
│   ├── user-structure.md       # ユーザーフローとプロジェクト構造 (このファイル)
│   └── timeline.md             # プロジェクトタイムライン
└── README.md                   # プロジェクトの基本的な説明、セットアップ方法など
```

**各ファイル/ディレクトリの説明:**

*   `.github/workflows/cron_tweet.yml`: 毎日の自動実行を定義する GitHub Actions ワークフローファイル。
*   `.gitignore`: `.env` ファイル、`.venv` フォルダ、Python のキャッシュファイル (`__pycache__`) など、リポジトリに含めたくないものを指定します。
*   `Dockerfile`: Python 実行環境、必要なライブラリを含む Docker イメージを定義します。
*   `requirements.txt`: `pip install -r requirements.txt` で必要な Python ライブラリをインストールできるようにリスト化します (`tweepy`, `python-dotenv`, `google-generativeai` など)。
*   `main.py`: 年の計算、テキストメーター生成、Gemini API 呼び出し、X への投稿といった、ボットの主要なロジックをすべて含む Python スクリプトです。
*   `.env.example`: ローカルで開発する際に必要な環境変数名 (APIキー名) を記載したテンプレートファイル。実際のキーは含めません。
*   `.env`: ローカル開発時に使用する実際のAPIキーなどを記述するファイル。`.gitignore` により Git の管理対象外となります。
*   `.venv/`: Python の仮想環境フォルダ。インストールされたライブラリなどが格納されます。`.gitignore` により Git の管理対象外となります。
*   `project-docs/`: このプロジェクトに関する設計ドキュメントを格納するディレクトリです。
*   `README.md`: プロジェクトの概要、ローカルでのセットアップ方法、GitHub Actions での実行方法、必要な Secrets の設定などを記述します。 